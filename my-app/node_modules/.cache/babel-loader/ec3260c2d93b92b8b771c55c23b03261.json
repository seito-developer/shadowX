{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.readdir = exports.readdirWithFileTypes = exports.read = void 0;\n\nconst fsStat = require(\"@nodelib/fs.stat\");\n\nconst rpl = require(\"run-parallel\");\n\nconst constants_1 = require(\"../constants\");\n\nconst utils = require(\"../utils\");\n\nconst common = require(\"./common\");\n\nfunction read(directory, settings, callback) {\n  if (!settings.stats && constants_1.IS_SUPPORT_READDIR_WITH_FILE_TYPES) {\n    return readdirWithFileTypes(directory, settings, callback);\n  }\n\n  return readdir(directory, settings, callback);\n}\n\nexports.read = read;\n\nfunction readdirWithFileTypes(directory, settings, callback) {\n  settings.fs.readdir(directory, {\n    withFileTypes: true\n  }, (readdirError, dirents) => {\n    if (readdirError !== null) {\n      return callFailureCallback(callback, readdirError);\n    }\n\n    const entries = dirents.map(dirent => ({\n      dirent,\n      name: dirent.name,\n      path: common.joinPathSegments(directory, dirent.name, settings.pathSegmentSeparator)\n    }));\n\n    if (!settings.followSymbolicLinks) {\n      return callSuccessCallback(callback, entries);\n    }\n\n    const tasks = entries.map(entry => makeRplTaskEntry(entry, settings));\n    rpl(tasks, (rplError, rplEntries) => {\n      if (rplError !== null) {\n        return callFailureCallback(callback, rplError);\n      }\n\n      callSuccessCallback(callback, rplEntries);\n    });\n  });\n}\n\nexports.readdirWithFileTypes = readdirWithFileTypes;\n\nfunction makeRplTaskEntry(entry, settings) {\n  return done => {\n    if (!entry.dirent.isSymbolicLink()) {\n      return done(null, entry);\n    }\n\n    settings.fs.stat(entry.path, (statError, stats) => {\n      if (statError !== null) {\n        if (settings.throwErrorOnBrokenSymbolicLink) {\n          return done(statError);\n        }\n\n        return done(null, entry);\n      }\n\n      entry.dirent = utils.fs.createDirentFromStats(entry.name, stats);\n      return done(null, entry);\n    });\n  };\n}\n\nfunction readdir(directory, settings, callback) {\n  settings.fs.readdir(directory, (readdirError, names) => {\n    if (readdirError !== null) {\n      return callFailureCallback(callback, readdirError);\n    }\n\n    const filepaths = names.map(name => common.joinPathSegments(directory, name, settings.pathSegmentSeparator));\n    const tasks = filepaths.map(filepath => {\n      return done => fsStat.stat(filepath, settings.fsStatSettings, done);\n    });\n    rpl(tasks, (rplError, results) => {\n      if (rplError !== null) {\n        return callFailureCallback(callback, rplError);\n      }\n\n      const entries = [];\n      names.forEach((name, index) => {\n        const stats = results[index];\n        const entry = {\n          name,\n          path: filepaths[index],\n          dirent: utils.fs.createDirentFromStats(name, stats)\n        };\n\n        if (settings.stats) {\n          entry.stats = stats;\n        }\n\n        entries.push(entry);\n      });\n      callSuccessCallback(callback, entries);\n    });\n  });\n}\n\nexports.readdir = readdir;\n\nfunction callFailureCallback(callback, error) {\n  callback(error);\n}\n\nfunction callSuccessCallback(callback, result) {\n  callback(null, result);\n}","map":{"version":3,"sources":["/Users/seito/Documents/develop/count-jp/my-app/node_modules/@nodelib/fs.scandir/out/providers/async.js"],"names":["Object","defineProperty","exports","value","readdir","readdirWithFileTypes","read","fsStat","require","rpl","constants_1","utils","common","directory","settings","callback","stats","IS_SUPPORT_READDIR_WITH_FILE_TYPES","fs","withFileTypes","readdirError","dirents","callFailureCallback","entries","map","dirent","name","path","joinPathSegments","pathSegmentSeparator","followSymbolicLinks","callSuccessCallback","tasks","entry","makeRplTaskEntry","rplError","rplEntries","done","isSymbolicLink","stat","statError","throwErrorOnBrokenSymbolicLink","createDirentFromStats","names","filepaths","filepath","fsStatSettings","results","forEach","index","push","error","result"],"mappings":"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","sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.readdir = exports.readdirWithFileTypes = exports.read = void 0;\r\nconst fsStat = require(\"@nodelib/fs.stat\");\r\nconst rpl = require(\"run-parallel\");\r\nconst constants_1 = require(\"../constants\");\r\nconst utils = require(\"../utils\");\r\nconst common = require(\"./common\");\r\nfunction read(directory, settings, callback) {\r\n    if (!settings.stats && constants_1.IS_SUPPORT_READDIR_WITH_FILE_TYPES) {\r\n        return readdirWithFileTypes(directory, settings, callback);\r\n    }\r\n    return readdir(directory, settings, callback);\r\n}\r\nexports.read = read;\r\nfunction readdirWithFileTypes(directory, settings, callback) {\r\n    settings.fs.readdir(directory, { withFileTypes: true }, (readdirError, dirents) => {\r\n        if (readdirError !== null) {\r\n            return callFailureCallback(callback, readdirError);\r\n        }\r\n        const entries = dirents.map((dirent) => ({\r\n            dirent,\r\n            name: dirent.name,\r\n            path: common.joinPathSegments(directory, dirent.name, settings.pathSegmentSeparator)\r\n        }));\r\n        if (!settings.followSymbolicLinks) {\r\n            return callSuccessCallback(callback, entries);\r\n        }\r\n        const tasks = entries.map((entry) => makeRplTaskEntry(entry, settings));\r\n        rpl(tasks, (rplError, rplEntries) => {\r\n            if (rplError !== null) {\r\n                return callFailureCallback(callback, rplError);\r\n            }\r\n            callSuccessCallback(callback, rplEntries);\r\n        });\r\n    });\r\n}\r\nexports.readdirWithFileTypes = readdirWithFileTypes;\r\nfunction makeRplTaskEntry(entry, settings) {\r\n    return (done) => {\r\n        if (!entry.dirent.isSymbolicLink()) {\r\n            return done(null, entry);\r\n        }\r\n        settings.fs.stat(entry.path, (statError, stats) => {\r\n            if (statError !== null) {\r\n                if (settings.throwErrorOnBrokenSymbolicLink) {\r\n                    return done(statError);\r\n                }\r\n                return done(null, entry);\r\n            }\r\n            entry.dirent = utils.fs.createDirentFromStats(entry.name, stats);\r\n            return done(null, entry);\r\n        });\r\n    };\r\n}\r\nfunction readdir(directory, settings, callback) {\r\n    settings.fs.readdir(directory, (readdirError, names) => {\r\n        if (readdirError !== null) {\r\n            return callFailureCallback(callback, readdirError);\r\n        }\r\n        const filepaths = names.map((name) => common.joinPathSegments(directory, name, settings.pathSegmentSeparator));\r\n        const tasks = filepaths.map((filepath) => {\r\n            return (done) => fsStat.stat(filepath, settings.fsStatSettings, done);\r\n        });\r\n        rpl(tasks, (rplError, results) => {\r\n            if (rplError !== null) {\r\n                return callFailureCallback(callback, rplError);\r\n            }\r\n            const entries = [];\r\n            names.forEach((name, index) => {\r\n                const stats = results[index];\r\n                const entry = {\r\n                    name,\r\n                    path: filepaths[index],\r\n                    dirent: utils.fs.createDirentFromStats(name, stats)\r\n                };\r\n                if (settings.stats) {\r\n                    entry.stats = stats;\r\n                }\r\n                entries.push(entry);\r\n            });\r\n            callSuccessCallback(callback, entries);\r\n        });\r\n    });\r\n}\r\nexports.readdir = readdir;\r\nfunction callFailureCallback(callback, error) {\r\n    callback(error);\r\n}\r\nfunction callSuccessCallback(callback, result) {\r\n    callback(null, result);\r\n}\r\n"]},"metadata":{},"sourceType":"script"}